# F1r3fly Standalone Development Configuration
# Optimized for fast development with instant finalization

standalone = true
autopropose = false

protocol-server {
  network-id = "standalone-dev"
  allow-private-addresses = true
  use-random-ports = false
  dynamic-ip = false
  no-upnp = true
  port = 40400
  grpc-max-recv-message-size = 256K
  grpc-max-recv-stream-message-size = 256M
  max-message-consumers = 400
  disable-state-exporter = false
}

protocol-client {
  network-id = ${protocol-server.network-id}
  disable-lfs = false
  batch-max-connections = 20
  network-timeout = 5 seconds
  grpc-max-recv-message-size = ${protocol-server.grpc-max-recv-message-size}
  grpc-stream-chunk-size = 256K
}

peers-discovery {
  port = 40404
  lookup-interval = 20 seconds
  cleanup-interval = 20 minutes
  heartbeat-batch-size = 100
  init-wait-loop-interval = 1 seconds
}

api-server {
  # host = "0.0.0.0"
  port-grpc-external = 40401
  port-grpc-internal = 40402
  grpc-max-recv-message-size = 16M
  port-http = 40403
  port-admin-http = 40405
  max-blocks-limit = 50
  enable-reporting = false
  keep-alive-time = 2 hours
  keep-alive-timeout = 20 seconds
  permit-keep-alive-time = 5 minutes
  max-connection-idle = 1 hours
  max-connection-age = 1 hours
  max-connection-age-grace = 1 hours
}

storage {
  data-dir = ${default-data-dir}
}

tls {
  certificate-path = ${storage.data-dir}/node.certificate.pem
  key-path = ${storage.data-dir}/node.key.pem
  secure-random-non-blocking = false
  custom-certificate-location = false
  custom-key-location = false
}

casper {
  # Instant finalization for development
  fault-tolerance-threshold = 0.0
  synchrony-constraint-threshold = 0.0
  
  shard-name = root
  parent-shard-id = /
  
  # Fast intervals for development
  casper-loop-interval = 5 seconds
  requested-blocks-timeout = 60 seconds
  finalization-rate = 1

  # Mergeable channel garbage collection
  enable-mergeable-channel-gc = false
  mergeable-channels-gc-interval = 5 minutes
  mergeable-channels-gc-depth-buffer = 10

  max-number-of-parents = 100
  max-parent-depth = 2147483647
  fork-choice-stale-threshold = 30 seconds
  fork-choice-check-if-stale-interval = 1 minutes
  height-constraint-threshold = 1000

  round-robin-dispatcher {
    max-peer-queue-size = 100
    give-up-after-skipped = 0
    drop-peer-after-retries = 0
  }

  genesis-block-data {
    genesis-data-dir = ${storage.data-dir}/genesis
    bonds-file = ${casper.genesis-block-data.genesis-data-dir}/bonds.txt
    wallets-file = ${casper.genesis-block-data.genesis-data-dir}/wallets.txt
    bond-minimum = 1
    bond-maximum = 9223372036854775807
    epoch-length = 10
    quarantine-length = 10
    number-of-active-validators = 1
    genesis-block-number = 0
    pos-multi-sig-public-keys = [
      04ffc016579a68050d655d55df4e09f04605164543e257c8e6df10361e6068a5336588e9b355ea859c5ab4285a5ef0efdf62bc28b80320ce99e26bb1607b3ad93d
    ]
    pos-multi-sig-quorum = 1
  }

  genesis-ceremony {
    # Instant genesis approval for standalone development
    required-signatures = 0
    approve-interval = 1 seconds
    approve-duration = 1 seconds
    autogen-shard-size = 1
    genesis-validator-mode = false
    ceremony-master-mode = true
  }

  min-phlo-price = 1

  # Heartbeat configuration for maintaining blockchain liveness
  heartbeat {
    # Enable heartbeat block proposing
    enabled = true

    # Check interval - how often to check if heartbeat is needed
    check-interval = 5 seconds

    # Maximum age of last finalized block before triggering heartbeat
    # If no block has been finalized in this duration, propose an empty block
    max-lfb-age = 10 seconds
  }
}

# Metrics configuration
metrics {
  prometheus = true
  influxdb = false
  influxdb-udp = false
  zipkin = false
  sigar = false
}

# Enable development mode
dev-mode = true

dev {
  # Pre-configured deployer private key for easy contract deployment
  # deployer-private-key = "5f668a7ee96d944a4494cc947e4005e172d7ab3461ee5538f1f2a45a835e9657"
}

# OpenAI configuration
openai {
  # Enable or disable OpenAI service functionality.
  # Priority order: 1. Environment variable OPENAI_ENABLED, 2. Configuration (this file), 3. Default (false)
  #
  # Configuration options:
  # - enabled = true:  OpenAI features are active and require a valid API key (node will crash at startup if missing)
  # - enabled = false: OpenAI features are disabled and no API key is required (safe mode)
  # - Comment out or omit: Falls back to environment variable OPENAI_ENABLED
  #
  # Environment variable OPENAI_ENABLED accepts: true/false, 1/0, yes/no, on/off (case insensitive)
  # Example: export OPENAI_ENABLED=true
  #
  # Default: false (disabled for safety)
  #
  # NOTE: When OpenAI is disabled (enabled = false), all AI-related system processes are excluded from the runtime.
  # If you attempt to deploy a contract that uses AI processes (rho:ai:gpt4, rho:ai:dalle3, rho:ai:textToAudio), 
  # the deployment will fail with an error similar to:
  #   "coop.rchain.rholang.interpreter.errors$BugFoundError: No value set for `rho:ai:dalle3`. 
  #    This is a bug in the normalizer or on the path from it."
  # This is expected behavior when AI is disabled - enable OpenAI to use AI processes.
  # enabled = false

  # API key used by OpenAIService. Only required when OpenAI service is enabled.
  # Resolution order: 1. This configuration, 2. Environment variable OPENAI_SCALA_CLIENT_API_KEY  
  # Example: api-key = "sk-********************************"
  # api-key = ""

  # Validate API key at startup by calling a lightweight endpoint (list models).
  # Set to false to skip validation.
  validate-api-key = true

  # Timeout for API key validation call.
  validation-timeout-sec = 15
}

